"use server";

import Home from "./clientpage";

async function checkForSession(roomId: string) {
  const cookieStore = useCookies();
  const playerId = cookieStore.get("session");
  if (playerId == undefined) redirect("/");
  const player = await GetPlayer(playerId);
  if (player == undefined) redirect("/");
  if (roomId != player.room) redirect(`/${player.room}`);
  return player;
}

async function checkForSession() {
  const cookieStore = await cookies();
  if (!cookieStore.has("session")) return;
  const session = cookieStore.get("session");
  if (session == undefined) return;
  const playerId = session.value;
  const player = await GetPlayer(playerId);
  if (player == undefined) {
    return;
  }

  return redirect(`/${player.room}`);
}

export default async function Buffer() {
  const roomId = useParams().id as string;
  player = await checkForSession(roomId);
  return <Home player={} />;
}
